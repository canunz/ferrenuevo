{"ast":null,"code":"import React,{createContext,useContext,useState,useEffect}from'react';import{servicioAuth}from'../servicios/servicioAuth';import{jsx as _jsx}from\"react/jsx-runtime\";const ContextoAuth=/*#__PURE__*/createContext();export const useAuth=()=>{const context=useContext(ContextoAuth);if(!context){throw new Error('useAuth debe ser usado dentro de AuthProvider');}return context;};export const AuthProvider=_ref=>{let{children}=_ref;const[usuario,setUsuario]=useState(null);const[cargando,setCargando]=useState(true);useEffect(()=>{// Verificar si hay un usuario en localStorage\nconst usuarioGuardado=localStorage.getItem('usuario');const tokenGuardado=localStorage.getItem('token');if(usuarioGuardado&&tokenGuardado){setUsuario(JSON.parse(usuarioGuardado));}setCargando(false);},[]);const iniciarSesion=async credenciales=>{setCargando(true);try{console.log('ðŸ” Iniciando proceso de login con credenciales:',credenciales);const res=await servicioAuth.iniciarSesion(credenciales);console.log('ðŸ“¬ Respuesta completa del backend:',res);console.log('âœ… Success:',res.success);console.log('ðŸ“Š Data:',res.data);console.log('ðŸ”‘ Token:',res.token);console.log('ðŸ‘¤ Usuario:',res.usuario);// Manejar tanto la estructura nueva {success, data} como la actual {token, usuario}\nif(res.success&&res.data){// Estructura nueva\nconsole.log('ðŸŽ‰ Login exitoso (estructura nueva), guardando datos...');setUsuario(res.data.usuario);localStorage.setItem('usuario',JSON.stringify(res.data.usuario));localStorage.setItem('token',res.data.token);console.log('ðŸ’¾ Datos guardados en localStorage');return{exito:true};}else if(res.token&&res.usuario){// Estructura actual del backend\nconsole.log('ðŸŽ‰ Login exitoso (estructura actual), guardando datos...');setUsuario(res.usuario);localStorage.setItem('usuario',JSON.stringify(res.usuario));localStorage.setItem('token',res.token);console.log('ðŸ’¾ Datos guardados en localStorage');return{exito:true};}else{console.log('âŒ Login fallido:',res.error||res.message);return{exito:false,mensaje:res.error||res.message||'Credenciales incorrectas'};}}catch(error){var _error$response,_error$response$data;console.log('ðŸ’¥ Error en el proceso de login:',error);return{exito:false,mensaje:(error===null||error===void 0?void 0:(_error$response=error.response)===null||_error$response===void 0?void 0:(_error$response$data=_error$response.data)===null||_error$response$data===void 0?void 0:_error$response$data.mensaje)||'Error en el servidor'};}finally{setCargando(false);}};const registrarse=async datosRegistro=>{setCargando(true);try{const res=await servicioAuth.registrarse(datosRegistro);console.log('Respuesta registro backend:',res);if(res.success){setUsuario({id:res.data.id,nombre:res.data.nombre,email:res.data.email,rol:res.data.rol});localStorage.setItem('usuario',JSON.stringify({id:res.data.id,nombre:res.data.nombre,email:res.data.email,rol:res.data.rol}));localStorage.setItem('token',res.data.token||'');return{exito:true};}else{return{exito:false,mensaje:res.error||res.message||'Error en el registro'};}}catch(error){return{exito:false,mensaje:'Error en el registro'};}finally{setCargando(false);}};const cerrarSesion=()=>{setUsuario(null);localStorage.removeItem('usuario');localStorage.removeItem('token');};const valor={usuario,cargando,iniciarSesion,registrarse,cerrarSesion};return/*#__PURE__*/_jsx(ContextoAuth.Provider,{value:valor,children:children});};","map":{"version":3,"names":["React","createContext","useContext","useState","useEffect","servicioAuth","jsx","_jsx","ContextoAuth","useAuth","context","Error","AuthProvider","_ref","children","usuario","setUsuario","cargando","setCargando","usuarioGuardado","localStorage","getItem","tokenGuardado","JSON","parse","iniciarSesion","credenciales","console","log","res","success","data","token","setItem","stringify","exito","error","message","mensaje","_error$response","_error$response$data","response","registrarse","datosRegistro","id","nombre","email","rol","cerrarSesion","removeItem","valor","Provider","value"],"sources":["C:/ferrenuevo/fronted/src/contexto/ContextoAuth.jsx"],"sourcesContent":["import React, { createContext, useContext, useState, useEffect } from 'react';\r\nimport { servicioAuth } from '../servicios/servicioAuth';\r\n\r\nconst ContextoAuth = createContext();\r\n\r\nexport const useAuth = () => {\r\n  const context = useContext(ContextoAuth);\r\n  if (!context) {\r\n    throw new Error('useAuth debe ser usado dentro de AuthProvider');\r\n  }\r\n  return context;\r\n};\r\n\r\nexport const AuthProvider = ({ children }) => {\r\n  const [usuario, setUsuario] = useState(null);\r\n  const [cargando, setCargando] = useState(true);\r\n\r\n  useEffect(() => {\r\n    // Verificar si hay un usuario en localStorage\r\n    const usuarioGuardado = localStorage.getItem('usuario');\r\n    const tokenGuardado = localStorage.getItem('token');\r\n    \r\n    if (usuarioGuardado && tokenGuardado) {\r\n      setUsuario(JSON.parse(usuarioGuardado));\r\n    }\r\n    \r\n    setCargando(false);\r\n  }, []);\r\n\r\n  const iniciarSesion = async (credenciales) => {\r\n    setCargando(true);\r\n    try {\r\n      console.log('ðŸ” Iniciando proceso de login con credenciales:', credenciales);\r\n      const res = await servicioAuth.iniciarSesion(credenciales);\r\n      console.log('ðŸ“¬ Respuesta completa del backend:', res);\r\n      console.log('âœ… Success:', res.success);\r\n      console.log('ðŸ“Š Data:', res.data);\r\n      console.log('ðŸ”‘ Token:', res.token);\r\n      console.log('ðŸ‘¤ Usuario:', res.usuario);\r\n      \r\n      // Manejar tanto la estructura nueva {success, data} como la actual {token, usuario}\r\n      if (res.success && res.data) {\r\n        // Estructura nueva\r\n        console.log('ðŸŽ‰ Login exitoso (estructura nueva), guardando datos...');\r\n        setUsuario(res.data.usuario);\r\n        localStorage.setItem('usuario', JSON.stringify(res.data.usuario));\r\n        localStorage.setItem('token', res.data.token);\r\n        console.log('ðŸ’¾ Datos guardados en localStorage');\r\n        return { exito: true };\r\n      } else if (res.token && res.usuario) {\r\n        // Estructura actual del backend\r\n        console.log('ðŸŽ‰ Login exitoso (estructura actual), guardando datos...');\r\n        setUsuario(res.usuario);\r\n        localStorage.setItem('usuario', JSON.stringify(res.usuario));\r\n        localStorage.setItem('token', res.token);\r\n        console.log('ðŸ’¾ Datos guardados en localStorage');\r\n        return { exito: true };\r\n      } else {\r\n        console.log('âŒ Login fallido:', res.error || res.message);\r\n        return { exito: false, mensaje: res.error || res.message || 'Credenciales incorrectas' };\r\n      }\r\n    } catch (error) {\r\n      console.log('ðŸ’¥ Error en el proceso de login:', error);\r\n      return { exito: false, mensaje: error?.response?.data?.mensaje || 'Error en el servidor' };\r\n    } finally {\r\n      setCargando(false);\r\n    }\r\n  };\r\n\r\n  const registrarse = async (datosRegistro) => {\r\n    setCargando(true);\r\n    try {\r\n      const res = await servicioAuth.registrarse(datosRegistro);\r\n      console.log('Respuesta registro backend:', res);\r\n      if (res.success) {\r\n        setUsuario({\r\n          id: res.data.id,\r\n          nombre: res.data.nombre,\r\n          email: res.data.email,\r\n          rol: res.data.rol\r\n        });\r\n        localStorage.setItem('usuario', JSON.stringify({\r\n          id: res.data.id,\r\n          nombre: res.data.nombre,\r\n          email: res.data.email,\r\n          rol: res.data.rol\r\n        }));\r\n        localStorage.setItem('token', res.data.token || '');\r\n        return { exito: true };\r\n      } else {\r\n        return { exito: false, mensaje: res.error || res.message || 'Error en el registro' };\r\n      }\r\n    } catch (error) {\r\n      return { exito: false, mensaje: 'Error en el registro' };\r\n    } finally {\r\n      setCargando(false);\r\n    }\r\n  };\r\n\r\n  const cerrarSesion = () => {\r\n    setUsuario(null);\r\n    localStorage.removeItem('usuario');\r\n    localStorage.removeItem('token');\r\n  };\r\n\r\n  const valor = {\r\n    usuario,\r\n    cargando,\r\n    iniciarSesion,\r\n    registrarse,\r\n    cerrarSesion\r\n  };\r\n\r\n  return (\r\n    <ContextoAuth.Provider value={valor}>\r\n      {children}\r\n    </ContextoAuth.Provider>\r\n  );\r\n};"],"mappings":"AAAA,MAAO,CAAAA,KAAK,EAAIC,aAAa,CAAEC,UAAU,CAAEC,QAAQ,CAAEC,SAAS,KAAQ,OAAO,CAC7E,OAASC,YAAY,KAAQ,2BAA2B,CAAC,OAAAC,GAAA,IAAAC,IAAA,yBAEzD,KAAM,CAAAC,YAAY,cAAGP,aAAa,CAAC,CAAC,CAEpC,MAAO,MAAM,CAAAQ,OAAO,CAAGA,CAAA,GAAM,CAC3B,KAAM,CAAAC,OAAO,CAAGR,UAAU,CAACM,YAAY,CAAC,CACxC,GAAI,CAACE,OAAO,CAAE,CACZ,KAAM,IAAI,CAAAC,KAAK,CAAC,+CAA+C,CAAC,CAClE,CACA,MAAO,CAAAD,OAAO,CAChB,CAAC,CAED,MAAO,MAAM,CAAAE,YAAY,CAAGC,IAAA,EAAkB,IAAjB,CAAEC,QAAS,CAAC,CAAAD,IAAA,CACvC,KAAM,CAACE,OAAO,CAAEC,UAAU,CAAC,CAAGb,QAAQ,CAAC,IAAI,CAAC,CAC5C,KAAM,CAACc,QAAQ,CAAEC,WAAW,CAAC,CAAGf,QAAQ,CAAC,IAAI,CAAC,CAE9CC,SAAS,CAAC,IAAM,CACd;AACA,KAAM,CAAAe,eAAe,CAAGC,YAAY,CAACC,OAAO,CAAC,SAAS,CAAC,CACvD,KAAM,CAAAC,aAAa,CAAGF,YAAY,CAACC,OAAO,CAAC,OAAO,CAAC,CAEnD,GAAIF,eAAe,EAAIG,aAAa,CAAE,CACpCN,UAAU,CAACO,IAAI,CAACC,KAAK,CAACL,eAAe,CAAC,CAAC,CACzC,CAEAD,WAAW,CAAC,KAAK,CAAC,CACpB,CAAC,CAAE,EAAE,CAAC,CAEN,KAAM,CAAAO,aAAa,CAAG,KAAO,CAAAC,YAAY,EAAK,CAC5CR,WAAW,CAAC,IAAI,CAAC,CACjB,GAAI,CACFS,OAAO,CAACC,GAAG,CAAC,iDAAiD,CAAEF,YAAY,CAAC,CAC5E,KAAM,CAAAG,GAAG,CAAG,KAAM,CAAAxB,YAAY,CAACoB,aAAa,CAACC,YAAY,CAAC,CAC1DC,OAAO,CAACC,GAAG,CAAC,oCAAoC,CAAEC,GAAG,CAAC,CACtDF,OAAO,CAACC,GAAG,CAAC,YAAY,CAAEC,GAAG,CAACC,OAAO,CAAC,CACtCH,OAAO,CAACC,GAAG,CAAC,UAAU,CAAEC,GAAG,CAACE,IAAI,CAAC,CACjCJ,OAAO,CAACC,GAAG,CAAC,WAAW,CAAEC,GAAG,CAACG,KAAK,CAAC,CACnCL,OAAO,CAACC,GAAG,CAAC,aAAa,CAAEC,GAAG,CAACd,OAAO,CAAC,CAEvC;AACA,GAAIc,GAAG,CAACC,OAAO,EAAID,GAAG,CAACE,IAAI,CAAE,CAC3B;AACAJ,OAAO,CAACC,GAAG,CAAC,yDAAyD,CAAC,CACtEZ,UAAU,CAACa,GAAG,CAACE,IAAI,CAAChB,OAAO,CAAC,CAC5BK,YAAY,CAACa,OAAO,CAAC,SAAS,CAAEV,IAAI,CAACW,SAAS,CAACL,GAAG,CAACE,IAAI,CAAChB,OAAO,CAAC,CAAC,CACjEK,YAAY,CAACa,OAAO,CAAC,OAAO,CAAEJ,GAAG,CAACE,IAAI,CAACC,KAAK,CAAC,CAC7CL,OAAO,CAACC,GAAG,CAAC,oCAAoC,CAAC,CACjD,MAAO,CAAEO,KAAK,CAAE,IAAK,CAAC,CACxB,CAAC,IAAM,IAAIN,GAAG,CAACG,KAAK,EAAIH,GAAG,CAACd,OAAO,CAAE,CACnC;AACAY,OAAO,CAACC,GAAG,CAAC,0DAA0D,CAAC,CACvEZ,UAAU,CAACa,GAAG,CAACd,OAAO,CAAC,CACvBK,YAAY,CAACa,OAAO,CAAC,SAAS,CAAEV,IAAI,CAACW,SAAS,CAACL,GAAG,CAACd,OAAO,CAAC,CAAC,CAC5DK,YAAY,CAACa,OAAO,CAAC,OAAO,CAAEJ,GAAG,CAACG,KAAK,CAAC,CACxCL,OAAO,CAACC,GAAG,CAAC,oCAAoC,CAAC,CACjD,MAAO,CAAEO,KAAK,CAAE,IAAK,CAAC,CACxB,CAAC,IAAM,CACLR,OAAO,CAACC,GAAG,CAAC,kBAAkB,CAAEC,GAAG,CAACO,KAAK,EAAIP,GAAG,CAACQ,OAAO,CAAC,CACzD,MAAO,CAAEF,KAAK,CAAE,KAAK,CAAEG,OAAO,CAAET,GAAG,CAACO,KAAK,EAAIP,GAAG,CAACQ,OAAO,EAAI,0BAA2B,CAAC,CAC1F,CACF,CAAE,MAAOD,KAAK,CAAE,KAAAG,eAAA,CAAAC,oBAAA,CACdb,OAAO,CAACC,GAAG,CAAC,kCAAkC,CAAEQ,KAAK,CAAC,CACtD,MAAO,CAAED,KAAK,CAAE,KAAK,CAAEG,OAAO,CAAE,CAAAF,KAAK,SAALA,KAAK,kBAAAG,eAAA,CAALH,KAAK,CAAEK,QAAQ,UAAAF,eAAA,kBAAAC,oBAAA,CAAfD,eAAA,CAAiBR,IAAI,UAAAS,oBAAA,iBAArBA,oBAAA,CAAuBF,OAAO,GAAI,sBAAuB,CAAC,CAC5F,CAAC,OAAS,CACRpB,WAAW,CAAC,KAAK,CAAC,CACpB,CACF,CAAC,CAED,KAAM,CAAAwB,WAAW,CAAG,KAAO,CAAAC,aAAa,EAAK,CAC3CzB,WAAW,CAAC,IAAI,CAAC,CACjB,GAAI,CACF,KAAM,CAAAW,GAAG,CAAG,KAAM,CAAAxB,YAAY,CAACqC,WAAW,CAACC,aAAa,CAAC,CACzDhB,OAAO,CAACC,GAAG,CAAC,6BAA6B,CAAEC,GAAG,CAAC,CAC/C,GAAIA,GAAG,CAACC,OAAO,CAAE,CACfd,UAAU,CAAC,CACT4B,EAAE,CAAEf,GAAG,CAACE,IAAI,CAACa,EAAE,CACfC,MAAM,CAAEhB,GAAG,CAACE,IAAI,CAACc,MAAM,CACvBC,KAAK,CAAEjB,GAAG,CAACE,IAAI,CAACe,KAAK,CACrBC,GAAG,CAAElB,GAAG,CAACE,IAAI,CAACgB,GAChB,CAAC,CAAC,CACF3B,YAAY,CAACa,OAAO,CAAC,SAAS,CAAEV,IAAI,CAACW,SAAS,CAAC,CAC7CU,EAAE,CAAEf,GAAG,CAACE,IAAI,CAACa,EAAE,CACfC,MAAM,CAAEhB,GAAG,CAACE,IAAI,CAACc,MAAM,CACvBC,KAAK,CAAEjB,GAAG,CAACE,IAAI,CAACe,KAAK,CACrBC,GAAG,CAAElB,GAAG,CAACE,IAAI,CAACgB,GAChB,CAAC,CAAC,CAAC,CACH3B,YAAY,CAACa,OAAO,CAAC,OAAO,CAAEJ,GAAG,CAACE,IAAI,CAACC,KAAK,EAAI,EAAE,CAAC,CACnD,MAAO,CAAEG,KAAK,CAAE,IAAK,CAAC,CACxB,CAAC,IAAM,CACL,MAAO,CAAEA,KAAK,CAAE,KAAK,CAAEG,OAAO,CAAET,GAAG,CAACO,KAAK,EAAIP,GAAG,CAACQ,OAAO,EAAI,sBAAuB,CAAC,CACtF,CACF,CAAE,MAAOD,KAAK,CAAE,CACd,MAAO,CAAED,KAAK,CAAE,KAAK,CAAEG,OAAO,CAAE,sBAAuB,CAAC,CAC1D,CAAC,OAAS,CACRpB,WAAW,CAAC,KAAK,CAAC,CACpB,CACF,CAAC,CAED,KAAM,CAAA8B,YAAY,CAAGA,CAAA,GAAM,CACzBhC,UAAU,CAAC,IAAI,CAAC,CAChBI,YAAY,CAAC6B,UAAU,CAAC,SAAS,CAAC,CAClC7B,YAAY,CAAC6B,UAAU,CAAC,OAAO,CAAC,CAClC,CAAC,CAED,KAAM,CAAAC,KAAK,CAAG,CACZnC,OAAO,CACPE,QAAQ,CACRQ,aAAa,CACbiB,WAAW,CACXM,YACF,CAAC,CAED,mBACEzC,IAAA,CAACC,YAAY,CAAC2C,QAAQ,EAACC,KAAK,CAAEF,KAAM,CAAApC,QAAA,CACjCA,QAAQ,CACY,CAAC,CAE5B,CAAC","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}